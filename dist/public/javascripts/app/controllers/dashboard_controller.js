define(['app/base', 'angularjs', 'fbase'], function(TimeSheetApp) {
  var DashBoardController;
  DashBoardController = (function() {
    function DashBoardController($scope, $rootScope, $sce, FirebaseService, $window, $firebaseObject, $firebaseArray) {
      $scope.moment = moment;
      $scope.startDate = moment({
        year: 2015,
        month: 6,
        day: 2
      }).add(Math.floor((moment().diff(moment({
        year: 2015,
        month: 6,
        day: 2
      }), 'days')) / 14) * 13, 'd');
      $scope.endDate = moment({
        year: 2015,
        month: 6,
        day: 2
      }).add(Math.ceil((moment().diff(moment({
        year: 2015,
        month: 6,
        day: 2
      }), 'days')) / 14) * 13, 'd');
      $scope.formattedStart = $scope.startDate.format('M/D/YY');
      $scope.formattedEnd = $scope.endDate.format('M/D/YY');
      $scope.currentTimeSheetKey = (moment($scope.formattedStart, 'M/D/YY').format("MMMM Do YYYY")) + "-" + (moment($scope.formattedEnd, 'M/D/YY').format("MMMM Do YYYY"));
      $scope.currentPayPeriod = (moment($scope.formattedStart, 'M/D/YY').format("MMMM Do YYYY")) + "-" + (moment($scope.formattedEnd, 'M/D/YY').format("MMMM Do YYYY"));
      $scope.lessonModel = {
        student: "",
        length: "",
        notes: ""
      };
      FirebaseService.rootRef.child('students').once("value", function(snap) {
        var k, students, v, _ref;
        students = [];
        _ref = snap.val();
        for (k in _ref) {
          v = _ref[k];
          students.push({
            id: k,
            name: v.firstName + " " + v.lastName,
            parent: v.parent
          });
        }
        return $scope.$apply(function() {
          return $scope.students = students;
        });
      });
      $rootScope.$watch('userBasic', function(newVal, oldVal) {
        if ($rootScope.userBasic) {
          if (!($rootScope.userBasic.manager || $rootScope.userBasic.mentor)) {
            return $rootScope.roleNotSet = true;
          } else {
            return $scope.loadDashboard();
          }
        }
      });
      $scope.nextPeriod = function() {
        var oldEndDate;
        oldEndDate = $scope.endDate;
        $scope.startDate = oldEndDate;
        $scope.formattedStart = $scope.startDate.format('M/D/YY');
        $scope.endDate = $scope.startDate.add(13, 'd');
        $scope.formattedEnd = $scope.endDate.format('M/D/YY');
        $scope.currentTimeSheetKey = (moment($scope.formattedStart, 'M/D/YY').format("MMMM Do YYYY")) + "-" + (moment($scope.formattedEnd, 'M/D/YY').format("MMMM Do YYYY"));
        $scope.reRenderDatePicker();
        if ($scope.currentDash === 'Mentor') {
          if ($scope.currentTimeSheet) {
            $scope.currentTimeSheet.$destroy();
          }
          $scope.currentTimeSheet = $firebaseObject($rootScope.currentUserRef.child("timesheets/" + $scope.currentTimeSheetKey + "/lessons"));
          return $scope.currentTimeSheetSubmitted = $firebaseObject($rootScope.currentUserRef.child("timesheets/" + $scope.currentTimeSheetKey + "/submitted"));
        }
      };
      $scope.prevPeriod = function() {
        $scope.startDate = moment($scope.formattedStart, 'M/D/YY').subtract(13, 'd');
        $scope.formattedStart = $scope.startDate.format('M/D/YY');
        $scope.endDate = moment($scope.formattedEnd, 'M/D/YY').subtract(13, 'd');
        $scope.formattedEnd = $scope.endDate.format('M/D/YY');
        $scope.currentTimeSheetKey = (moment($scope.formattedStart, 'M/D/YY').format("MMMM Do YYYY")) + "-" + (moment($scope.formattedEnd, 'M/D/YY').format("MMMM Do YYYY"));
        $scope.reRenderDatePicker();
        if ($scope.currentDash === 'Mentor') {
          if ($scope.currentTimeSheet) {
            $scope.currentTimeSheet.$destroy();
          }
          $scope.currentTimeSheet = $firebaseObject($rootScope.currentUserRef.child("timesheets/" + $scope.currentTimeSheetKey + "/lessons"));
          return $scope.currentTimeSheetSubmitted = $firebaseObject($rootScope.currentUserRef.child("timesheets/" + $scope.currentTimeSheetKey + "/submitted"));
        }
      };
      $scope.reRenderDatePicker = function() {
        var maxDate, minDate;
        minDate = $scope.startDate.toDate();
        maxDate = $scope.endDate.toDate();
        $('#datepicker-01').datepicker("option", "maxDate", maxDate);
        $('#datepicker-01').datepicker("option", "minDate", minDate);
      };
      $scope.loadDashboard = function() {
        var datepickerSelector, maxDate, minDate;
        if ($rootScope.userBasic.manager) {
          $scope.selectedTab = 'TIMESHEETS';
          $scope.currentDash = 'Manager';
          return $scope.mentors = $firebaseObject(FirebaseService.rootRef.child('users').startAt('mentor').endAt('mentor'));
        } else {
          $scope.currentDash = 'Mentor';
          $scope.currentTimeSheet = $firebaseObject($rootScope.currentUserRef.child("timesheets/" + $scope.currentTimeSheetKey + "/lessons"));
          $scope.currentTimeSheetSubmitted = $firebaseObject($rootScope.currentUserRef.child("timesheets/" + $scope.currentTimeSheetKey + "/submitted"));
          minDate = $scope.startDate.toDate();
          maxDate = $scope.endDate.toDate();
          datepickerSelector = $('#datepicker-01');
          datepickerSelector.datepicker({
            showOtherMonths: true,
            selectOtherMonths: true,
            minDate: minDate,
            maxDate: maxDate,
            dateFormat: 'm/d/yy',
            yearRange: '-1:+1'
          }).prev('.input-group-btn').on('click', function(e) {
            e && e.preventDefault();
            datepickerSelector.focus();
          });
          $.extend($.datepicker, {
            _checkOffset: function(inst, offset, isFixed) {
              return offset;
            }
          });
          datepickerSelector.datepicker('widget').css({
            'margin-left': -datepickerSelector.prev('.input-group-btn').find('.btn').outerWidth() + 3
          });
          return $scope.reRenderDatePicker();
        }
      };
      $scope.openTimesheetsTab = function() {
        return $scope.selectedTab = 'TIMESHEETS';
      };
      $scope.formatLabel = function(item) {
        if (item) {
          return item.name;
        }
      };
      $scope.openInvoicesTab = function() {
        $scope.selectedTab = 'INVOICES';
        return $scope.parents = $firebaseObject($rootScope.rootRef.child("parents"));
      };
      $scope.addLesson = function() {
        if (!$scope.lessonModel.student.id) {
          alert('Please select a student from the drop down menu.');
        }
        if ($scope.lessonModel.student.id && $scope.lessonModel.length.length > 0 && $('#datepicker-01').val().length > 0) {
          $scope.lessonModel.date = moment($('#datepicker-01').val(), 'M/D/YYYY').format("MMMM Do YYYY");
          $rootScope.currentUserRef.child("timesheets/" + $scope.currentTimeSheetKey + "/lessons").push().set($scope.lessonModel);
          return $scope.lessonModel = {
            student: "",
            length: "",
            notes: ""
          };
        }
      };
      $scope.removeLesson = function(id) {
        return $rootScope.currentUserRef.child("timesheets/" + $scope.currentTimeSheetKey + "/lessons/" + id).set(null);
      };
      $scope.submitTimeSheet = function() {
        var result, totalTime;
        result = confirm("Are you sure? You are finalizing your timesheet for this pay period. This action cannot be undone.");
        if (result) {
          $rootScope.currentUserRef.child("timesheets/" + $scope.currentTimeSheetKey + "/submitted").set(true);
          totalTime = 0.00;
          angular.forEach($scope.currentTimeSheet, function(value, key) {
            totalTime = totalTime + parseFloat(value.length);
            return $rootScope.rootRef.child("parents/" + value.student.parent.parentId + "/invoices/" + $scope.currentTimeSheetKey).push().set({
              date: value.date,
              studentName: value.student.name,
              length: value.length,
              notes: value.notes,
              mentorId: $rootScope.currentUid,
              mentorName: $rootScope.userBasic.firstName + " " + $rootScope.userBasic.lastName
            });
          });
          $rootScope.currentUserRef.child("timesheets/" + $scope.currentTimeSheetKey + "/totalTime").set(totalTime);
          return $rootScope.currentUserRef.child("timesheets/" + $scope.currentTimeSheetKey).setPriority('submitted');
        }
      };
      $scope.manageMentor = function(userid, mentor) {
        $scope.showManageMentor = true;
        return $scope.showManageMentorObj = mentor;
      };
      $scope.calculateTotalHoursForAParent = function(lessons) {
        var k, totalHours, v;
        totalHours = 0;
        for (k in lessons) {
          v = lessons[k];
          totalHours = parseFloat(v.length) + totalHours;
        }
        return totalHours;
      };
      $scope.manageParent = function(userid, parent) {
        $scope.showManageParent = true;
        return $scope.showManageParentObj = parent;
      };
      $scope.checkCurrentPayPeriod = function() {
        return moment().isBetween($scope.startDate, $scope.endDate);
      };
    }

    return DashBoardController;

  })();
  DashBoardController.$inject = ["$scope", "$rootScope", "$sce", "FirebaseService", "$window", "$firebaseObject", "$firebaseArray"];
  TimeSheetApp.controller('DashBoardController', DashBoardController);
  return DashBoardController;
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL2tyaXNobmFyb2toYWxlL2NvZGUvbGV2ZWwvbGV2ZWwvdGltZXNoZWV0YXBwL3B1YmxpYy9qYXZhc2NyaXB0cy9hcHAvY29udHJvbGxlcnMvZGFzaGJvYXJkX2NvbnRyb2xsZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIvVXNlcnMva3Jpc2huYXJva2hhbGUvY29kZS9sZXZlbC9sZXZlbC90aW1lc2hlZXRhcHAvYXNzZXRzL2phdmFzY3JpcHRzL2FwcC9jb250cm9sbGVycy9kYXNoYm9hcmRfY29udHJvbGxlci5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsTUFBQSxDQUFPLENBQUUsVUFBRixFQUFhLFdBQWIsRUFBMEIsT0FBMUIsQ0FBUCxFQUEwQyxTQUFDLFlBQUQsR0FBQTtBQUV4QyxNQUFBLG1CQUFBO0FBQUEsRUFBTTtBQUVTLElBQUEsNkJBQUMsTUFBRCxFQUFTLFVBQVQsRUFBcUIsSUFBckIsRUFBMkIsZUFBM0IsRUFBNEMsT0FBNUMsRUFBcUQsZUFBckQsRUFBc0UsY0FBdEUsR0FBQTtBQUVYLE1BQUEsTUFBTSxDQUFDLE1BQVAsR0FBZ0IsTUFBaEIsQ0FBQTtBQUFBLE1BQ0EsTUFBTSxDQUFDLFNBQVAsR0FBbUIsTUFBQSxDQUFPO0FBQUEsUUFBRSxJQUFBLEVBQU0sSUFBUjtBQUFBLFFBQWMsS0FBQSxFQUFPLENBQXJCO0FBQUEsUUFBd0IsR0FBQSxFQUFLLENBQTdCO09BQVAsQ0FBdUMsQ0FBQyxHQUF4QyxDQUE0QyxJQUFJLENBQUMsS0FBTCxDQUFXLENBQUMsTUFBQSxDQUFBLENBQVEsQ0FBQyxJQUFULENBQWMsTUFBQSxDQUFPO0FBQUEsUUFBRSxJQUFBLEVBQU0sSUFBUjtBQUFBLFFBQWMsS0FBQSxFQUFPLENBQXJCO0FBQUEsUUFBd0IsR0FBQSxFQUFLLENBQTdCO09BQVAsQ0FBZCxFQUF3RCxNQUF4RCxDQUFELENBQUEsR0FBaUUsRUFBNUUsQ0FBQSxHQUFnRixFQUE1SCxFQUFpSSxHQUFq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Q0E3SnRCLENBQUE7QUFBQSxNQWtLQSxNQUFNLENBQUMscUJBQVAsR0FBK0IsU0FBQSxHQUFBO2VBQzdCLE1BQUEsQ0FBQSxDQUFRLENBQUMsU0FBVCxDQUFtQixNQUFNLENBQUMsU0FBMUIsRUFBcUMsTUFBTSxDQUFDLE9BQTVDLEVBRDZCO01BQUEsQ0FsSy9CLENBRlc7SUFBQSxDQUFiOzsrQkFBQTs7TUFGRixDQUFBO0FBQUEsRUE0S0EsbUJBQW1CLENBQUMsT0FBcEIsR0FBOEIsQ0FBRSxRQUFGLEVBQVksWUFBWixFQUEwQixNQUExQixFQUFrQyxpQkFBbEMsRUFBcUQsU0FBckQsRUFBZ0UsaUJBQWhFLEVBQW1GLGdCQUFuRixDQTVLOUIsQ0FBQTtBQUFBLEVBOEtBLFlBQVksQ0FBQyxVQUFiLENBQXlCLHFCQUF6QixFQUErQyxtQkFBL0MsQ0E5S0EsQ0FBQTtTQWdMQSxvQkFsTHdDO0FBQUEsQ0FBMUMsQ0FBQSxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiXG5kZWZpbmUgWydhcHAvYmFzZScsJ2FuZ3VsYXJqcycsICdmYmFzZSddLCAoVGltZVNoZWV0QXBwKSAtPlxuXG4gIGNsYXNzIERhc2hCb2FyZENvbnRyb2xsZXJcblxuICAgIGNvbnN0cnVjdG9yOiAoJHNjb3BlLCAkcm9vdFNjb3BlLCAkc2NlLCBGaXJlYmFzZVNlcnZpY2UsICR3aW5kb3csICRmaXJlYmFzZU9iamVjdCwgJGZpcmViYXNlQXJyYXkpIC0+XG5cbiAgICAgICRzY29wZS5tb21lbnQgPSBtb21lbnRcbiAgICAgICRzY29wZS5zdGFydERhdGUgPSBtb21lbnQoeyB5ZWFyIDoyMDE1LCBtb250aCA6NiwgZGF5IDoyfSkuYWRkKE1hdGguZmxvb3IoKG1vbWVudCgpLmRpZmYobW9tZW50KHsgeWVhciA6MjAxNSwgbW9udGggOjYsIGRheSA6Mn0pLCAnZGF5cycpKS8xNCkqMTMsICdkJylcbiAgICAgICRzY29wZS5lbmREYXRlID0gbW9tZW50KHsgeWVhciA6MjAxNSwgbW9udGggOjYsIGRheSA6Mn0pLmFkZChNYXRoLmNlaWwoKG1vbWVudCgpLmRpZmYobW9tZW50KHsgeWVhciA6MjAxNSwgbW9udGggOjYsIGRheSA6Mn0pLCAnZGF5cycpKS8xNCkqMTMsICdkJylcblxuXG4gICAgICAkc2NvcGUuZm9ybWF0dGVkU3RhcnQgPSAkc2NvcGUuc3RhcnREYXRlLmZvcm1hdCgnTS9EL1lZJylcbiAgICAgICRzY29wZS5mb3JtYXR0ZWRFbmQgPSAkc2NvcGUuZW5kRGF0ZS5mb3JtYXQoJ00vRC9ZWScpXG5cbiAgICAgICRzY29wZS5jdXJyZW50VGltZVNoZWV0S2V5ID0gXCIje21vbWVudCgkc2NvcGUuZm9ybWF0dGVkU3RhcnQsICdNL0QvWVknKS5mb3JtYXQoXCJNTU1NIERvIFlZWVlcIil9LSN7bW9tZW50KCRzY29wZS5mb3JtYXR0ZWRFbmQsICdNL0QvWVknKS5mb3JtYXQoXCJNTU1NIERvIFlZWVlcIil9XCJcbiAgICAgICRzY29wZS5jdXJyZW50UGF5UGVyaW9kID0gXCIje21vbWVudCgkc2NvcGUuZm9ybWF0dGVkU3RhcnQsICdNL0QvWVknKS5mb3JtYXQoXCJNTU1NIERvIFlZWVlcIil9LSN7bW9tZW50KCRzY29wZS5mb3JtYXR0ZWRFbmQsICdNL0QvWVknKS5mb3JtYXQoXCJNTU1NIERvIFlZWVlcIil9XCJcblxuXG4gICAgICAkc2NvcGUubGVzc29uTW9kZWwgPSB7c3R1ZGVudDogXCJcIiwgbGVuZ3RoOiBcIlwiLCBub3RlczogXCJcIn1cblxuICAgICAgRmlyZWJhc2VTZXJ2aWNlLnJvb3RSZWYuY2hpbGQoJ3N0dWRlbnRzJykub25jZSBcInZhbHVlXCIsIChzbmFwKSAtPlxuICAgICAgICBzdHVkZW50cyA9IFtdXG4gICAgICAgIGZvciBrLHYgb2Ygc25hcC52YWwoKVxuICAgICAgICAgIHN0dWRlbnRzLnB1c2gge2lkOiBrLCBuYW1lOiBcIiN7di5maXJzdE5hbWV9ICN7di5sYXN0TmFtZX1cIiwgcGFyZW50OiB2LnBhcmVudH1cblxuICAgICAgICAkc2NvcGUuJGFwcGx5IC0+XG4gICAgICAgICAgJHNjb3BlLnN0dWRlbnRzID0gc3R1ZGVudHNcblxuXG4gICAgICAkcm9vdFNjb3BlLiR3YXRjaCAndXNlckJhc2ljJywgKG5ld1ZhbCwgb2xkVmFsKSAtPlxuICAgICAgICBpZiAkcm9vdFNjb3BlLnVzZXJCYXNpY1xuICAgICAgICAgIHVubGVzcyAkcm9vdFNjb3BlLnVzZXJCYXNpYy5tYW5hZ2VyIHx8ICRyb290U2NvcGUudXNlckJhc2ljLm1lbnRvclxuICAgICAgICAgICAgJHJvb3RTY29wZS5yb2xlTm90U2V0ID0gdHJ1ZVxuICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICRzY29wZS5sb2FkRGFzaGJvYXJkKClcblxuXG5cbiAgICAgICRzY29wZS5uZXh0UGVyaW9kID0gKCkgLT5cbiAgICAgICAgb2xkRW5kRGF0ZSA9ICRzY29wZS5lbmREYXRlXG4gICAgICAgICRzY29wZS5zdGFydERhdGUgPSBvbGRFbmREYXRlXG4gICAgICAgICRzY29wZS5mb3JtYXR0ZWRTdGFydCA9ICRzY29wZS5zdGFydERhdGUuZm9ybWF0KCdNL0QvWVknKVxuXG4gICAgICAgICRzY29wZS5lbmREYXRlID0gJHNjb3BlLnN0YXJ0RGF0ZS5hZGQoMTMsICdkJylcbiAgICAgICAgJHNjb3BlLmZvcm1hdHRlZEVuZCA9ICRzY29wZS5lbmREYXRlLmZvcm1hdCgnTS9EL1lZJylcblxuICAgICAgICAkc2NvcGUuY3VycmVudFRpbWVTaGVldEtleSA9IFwiI3ttb21lbnQoJHNjb3BlLmZvcm1hdHRlZFN0YXJ0LCAnTS9EL1lZJykuZm9ybWF0KFwiTU1NTSBEbyBZWVlZXCIpfS0je21vbWVudCgkc2NvcGUuZm9ybWF0dGVkRW5kLCAnTS9EL1lZJykuZm9ybWF0KFwiTU1NTSBEbyBZWVlZXCIpfVwiXG5cbiAgICAgICAgJHNjb3BlLnJlUmVuZGVyRGF0ZVBpY2tlcigpXG5cbiAgICAgICAgaWYgJHNjb3BlLmN1cnJlbnREYXNoID09ICdNZW50b3InXG4gICAgICAgICAgJHNjb3BlLmN1cnJlbnRUaW1lU2hlZXQuJGRlc3Ryb3koKSBpZiAkc2NvcGUuY3VycmVudFRpbWVTaGVldFxuICAgICAgICAgICRzY29wZS5jdXJyZW50VGltZVNoZWV0ID0gJGZpcmViYXNlT2JqZWN0KCRyb290U2NvcGUuY3VycmVudFVzZXJSZWYuY2hpbGQoXCJ0aW1lc2hlZXRzLyN7JHNjb3BlLmN1cnJlbnRUaW1lU2hlZXRLZXl9L2xlc3NvbnNcIikpXG4gICAgICAgICAgJHNjb3BlLmN1cnJlbnRUaW1lU2hlZXRTdWJtaXR0ZWQgPSAkZmlyZWJhc2VPYmplY3QoJHJvb3RTY29wZS5jdXJyZW50VXNlclJlZi5jaGlsZChcInRpbWVzaGVldHMvI3skc2NvcGUuY3VycmVudFRpbWVTaGVldEtleX0vc3VibWl0dGVkXCIpKVxuXG5cbiAgICAgICRzY29wZS5wcmV2UGVyaW9kID0gKCkgLT5cbiAgICAgICAgJHNjb3BlLnN0YXJ0RGF0ZSA9IG1vbWVudCgkc2NvcGUuZm9ybWF0dGVkU3RhcnQsICdNL0QvWVknKS5zdWJ0cmFjdCgxMywgJ2QnKVxuICAgICAgICAkc2NvcGUuZm9ybWF0dGVkU3RhcnQgPSAkc2NvcGUuc3RhcnREYXRlLmZvcm1hdCgnTS9EL1lZJylcblxuICAgICAgICAkc2NvcGUuZW5kRGF0ZSA9IG1vbWVudCgkc2NvcGUuZm9ybWF0dGVkRW5kLCAnTS9EL1lZJykuc3VidHJhY3QoMTMsICdkJylcbiAgICAgICAgJHNjb3BlLmZvcm1hdHRlZEVuZCA9ICRzY29wZS5lbmREYXRlLmZvcm1hdCgnTS9EL1lZJylcblxuICAgICAgICAkc2NvcGUuY3VycmVudFRpbWVTaGVldEtleSA9IFwiI3ttb21lbnQoJHNjb3BlLmZvcm1hdHRlZFN0YXJ0LCAnTS9EL1lZJykuZm9ybWF0KFwiTU1NTSBEbyBZWVlZXCIpfS0je21vbWVudCgkc2NvcGUuZm9ybWF0dGVkRW5kLCAnTS9EL1lZJykuZm9ybWF0KFwiTU1NTSBEbyBZWVlZXCIpfVwiXG5cbiAgICAgICAgJHNjb3BlLnJlUmVuZGVyRGF0ZVBpY2tlcigpXG5cbiAgICAgICAgaWYgJHNjb3BlLmN1cnJlbnREYXNoID09ICdNZW50b3InXG4gICAgICAgICAgJHNjb3BlLmN1cnJlbnRUaW1lU2hlZXQuJGRlc3Ryb3koKSBpZiAkc2NvcGUuY3VycmVudFRpbWVTaGVldFxuICAgICAgICAgICRzY29wZS5jdXJyZW50VGltZVNoZWV0ID0gJGZpcmViYXNlT2JqZWN0KCRyb290U2NvcGUuY3VycmVudFVzZXJSZWYuY2hpbGQoXCJ0aW1lc2hlZXRzLyN7JHNjb3BlLmN1cnJlbnRUaW1lU2hlZXRLZXl9L2xlc3NvbnNcIikpXG4gICAgICAgICAgJHNjb3BlLmN1cnJlbnRUaW1lU2hlZXRTdWJtaXR0ZWQgPSAkZmlyZWJhc2VPYmplY3QoJHJvb3RTY29wZS5jdXJyZW50VXNlclJlZi5jaGlsZChcInRpbWVzaGVldHMvI3skc2NvcGUuY3VycmVudFRpbWVTaGVldEtleX0vc3VibWl0dGVkXCIpKVxuXG5cbiAgICAgICRzY29wZS5yZVJlbmRlckRhdGVQaWNrZXIgPSAoKSAtPlxuICAgICAgICBtaW5EYXRlID0gJHNjb3BlLnN0YXJ0RGF0ZS50b0RhdGUoKVxuICAgICAgICBtYXhEYXRlID0gJHNjb3BlLmVuZERhdGUudG9EYXRlKClcbiAgICAgICAgJCgnI2RhdGVwaWNrZXItMDEnKS5kYXRlcGlja2VyKCBcIm9wdGlvblwiLCBcIm1heERhdGVcIiwgbWF4RGF0ZSApXG4gICAgICAgICQoJyNkYXRlcGlja2VyLTAxJykuZGF0ZXBpY2tlciggXCJvcHRpb25cIiwgXCJtaW5EYXRlXCIsIG1pbkRhdGUgKVxuICAgICAgICByZXR1cm5cblxuXG4gICAgICAkc2NvcGUubG9hZERhc2hib2FyZCA9ICgpIC0+XG4gICAgICAgIGlmICRyb290U2NvcGUudXNlckJhc2ljLm1hbmFnZXJcbiAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRUYWIgPSAnVElNRVNIRUVUUydcbiAgICAgICAgICAkc2NvcGUuY3VycmVudERhc2ggPSAnTWFuYWdlcidcbiAgICAgICAgICAkc2NvcGUubWVudG9ycyA9ICRmaXJlYmFzZU9iamVjdChGaXJlYmFzZVNlcnZpY2Uucm9vdFJlZi5jaGlsZCgndXNlcnMnKS5zdGFydEF0KCdtZW50b3InKS5lbmRBdCgnbWVudG9yJykpXG5cbiAgICAgICAgZWxzZVxuICAgICAgICAgICRzY29wZS5jdXJyZW50RGFzaCA9ICdNZW50b3InXG5cbiAgICAgICAgICAkc2NvcGUuY3VycmVudFRpbWVTaGVldCA9ICRmaXJlYmFzZU9iamVjdCgkcm9vdFNjb3BlLmN1cnJlbnRVc2VyUmVmLmNoaWxkKFwidGltZXNoZWV0cy8jeyRzY29wZS5jdXJyZW50VGltZVNoZWV0S2V5fS9sZXNzb25zXCIpKVxuICAgICAgICAgICRzY29wZS5jdXJyZW50VGltZVNoZWV0U3VibWl0dGVkID0gJGZpcmViYXNlT2JqZWN0KCRyb290U2NvcGUuY3VycmVudFVzZXJSZWYuY2hpbGQoXCJ0aW1lc2hlZXRzLyN7JHNjb3BlLmN1cnJlbnRUaW1lU2hlZXRLZXl9L3N1Ym1pdHRlZFwiKSlcblxuICAgICAgICAgIG1pbkRhdGUgPSAkc2NvcGUuc3RhcnREYXRlLnRvRGF0ZSgpXG4gICAgICAgICAgbWF4RGF0ZSA9ICRzY29wZS5lbmREYXRlLnRvRGF0ZSgpXG5cbiAgICAgICAgICBkYXRlcGlja2VyU2VsZWN0b3IgPSAkKCcjZGF0ZXBpY2tlci0wMScpXG4gICAgICAgICAgZGF0ZXBpY2tlclNlbGVjdG9yLmRhdGVwaWNrZXIoXG4gICAgICAgICAgICBzaG93T3RoZXJNb250aHM6IHRydWVcbiAgICAgICAgICAgIHNlbGVjdE90aGVyTW9udGhzOiB0cnVlXG4gICAgICAgICAgICBtaW5EYXRlOiBtaW5EYXRlXG4gICAgICAgICAgICBtYXhEYXRlOiBtYXhEYXRlXG4gICAgICAgICAgICBkYXRlRm9ybWF0OiAnbS9kL3l5J1xuICAgICAgICAgICAgeWVhclJhbmdlOiAnLTE6KzEnKS5wcmV2KCcuaW5wdXQtZ3JvdXAtYnRuJykub24gJ2NsaWNrJywgKGUpIC0+XG4gICAgICAgICAgICAgIGUgYW5kIGUucHJldmVudERlZmF1bHQoKVxuICAgICAgICAgICAgICBkYXRlcGlja2VyU2VsZWN0b3IuZm9jdXMoKVxuICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAkLmV4dGVuZCAkLmRhdGVwaWNrZXIsIF9jaGVja09mZnNldDogKGluc3QsIG9mZnNldCwgaXNGaXhlZCkgLT5cbiAgICAgICAgICAgIG9mZnNldFxuICAgICAgICAgIGRhdGVwaWNrZXJTZWxlY3Rvci5kYXRlcGlja2VyKCd3aWRnZXQnKS5jc3MgJ21hcmdpbi1sZWZ0JzogLWRhdGVwaWNrZXJTZWxlY3Rvci5wcmV2KCcuaW5wdXQtZ3JvdXAtYnRuJykuZmluZCgnLmJ0bicpLm91dGVyV2lkdGgoKSArIDNcblxuICAgICAgICAgICRzY29wZS5yZVJlbmRlckRhdGVQaWNrZXIoKVxuXG4gICAgICAkc2NvcGUub3BlblRpbWVzaGVldHNUYWIgPSAoKSAtPlxuICAgICAgICAkc2NvcGUuc2VsZWN0ZWRUYWIgPSAnVElNRVNIRUVUUydcblxuXG4gICAgICAkc2NvcGUuZm9ybWF0TGFiZWwgPSAoaXRlbSkgLT5cbiAgICAgICAgaXRlbS5uYW1lIGlmIGl0ZW1cblxuXG4gICAgICAkc2NvcGUub3Blbkludm9pY2VzVGFiID0gKCkgLT5cbiAgICAgICAgJHNjb3BlLnNlbGVjdGVkVGFiID0gJ0lOVk9JQ0VTJ1xuICAgICAgICAkc2NvcGUucGFyZW50cyA9ICRmaXJlYmFzZU9iamVjdCgkcm9vdFNjb3BlLnJvb3RSZWYuY2hpbGQoXCJwYXJlbnRzXCIpKVxuXG5cbiAgICAgICRzY29wZS5hZGRMZXNzb24gPSAoKSAtPlxuICAgICAgICB1bmxlc3MgJHNjb3BlLmxlc3Nvbk1vZGVsLnN0dWRlbnQuaWRcbiAgICAgICAgICBhbGVydCAnUGxlYXNlIHNlbGVjdCBhIHN0dWRlbnQgZnJvbSB0aGUgZHJvcCBkb3duIG1lbnUuJ1xuXG4gICAgICAgIGlmICRzY29wZS5sZXNzb25Nb2RlbC5zdHVkZW50LmlkIGFuZCAkc2NvcGUubGVzc29uTW9kZWwubGVuZ3RoLmxlbmd0aCA+IDAgYW5kICQoJyNkYXRlcGlja2VyLTAxJykudmFsKCkubGVuZ3RoID4gMFxuICAgICAgICAgICRzY29wZS5sZXNzb25Nb2RlbC5kYXRlID0gbW9tZW50KCQoJyNkYXRlcGlja2VyLTAxJykudmFsKCksICdNL0QvWVlZWScpLmZvcm1hdChcIk1NTU0gRG8gWVlZWVwiKVxuICAgICAgICAgICRyb290U2NvcGUuY3VycmVudFVzZXJSZWYuY2hpbGQoXCJ0aW1lc2hlZXRzLyN7JHNjb3BlLmN1cnJlbnRUaW1lU2hlZXRLZXl9L2xlc3NvbnNcIikucHVzaCgpLnNldCAkc2NvcGUubGVzc29uTW9kZWxcbiAgICAgICAgICAkc2NvcGUubGVzc29uTW9kZWwgPSB7c3R1ZGVudDogXCJcIiwgbGVuZ3RoOiBcIlwiLCBub3RlczogXCJcIn1cblxuICAgICAgJHNjb3BlLnJlbW92ZUxlc3NvbiA9IChpZCkgLT5cbiAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50VXNlclJlZi5jaGlsZChcInRpbWVzaGVldHMvI3skc2NvcGUuY3VycmVudFRpbWVTaGVldEtleX0vbGVzc29ucy8je2lkfVwiKS5zZXQgbnVsbFxuXG4gICAgICAkc2NvcGUuc3VibWl0VGltZVNoZWV0ID0gKCkgLT5cbiAgICAgICAgcmVzdWx0ID0gY29uZmlybShcIkFyZSB5b3Ugc3VyZT8gWW91IGFyZSBmaW5hbGl6aW5nIHlvdXIgdGltZXNoZWV0IGZvciB0aGlzIHBheSBwZXJpb2QuIFRoaXMgYWN0aW9uIGNhbm5vdCBiZSB1bmRvbmUuXCIpXG4gICAgICAgIGlmIHJlc3VsdFxuICAgICAgICAgICRyb290U2NvcGUuY3VycmVudFVzZXJSZWYuY2hpbGQoXCJ0aW1lc2hlZXRzLyN7JHNjb3BlLmN1cnJlbnRUaW1lU2hlZXRLZXl9L3N1Ym1pdHRlZFwiKS5zZXQgdHJ1ZVxuXG4gICAgICAgICAgdG90YWxUaW1lID0gMC4wMFxuICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCAkc2NvcGUuY3VycmVudFRpbWVTaGVldCwgKHZhbHVlLCBrZXkpIC0+XG4gICAgICAgICAgICB0b3RhbFRpbWUgPSB0b3RhbFRpbWUgKyBwYXJzZUZsb2F0KHZhbHVlLmxlbmd0aClcbiAgICAgICAgICAgICRyb290U2NvcGUucm9vdFJlZi5jaGlsZChcInBhcmVudHMvI3t2YWx1ZS5zdHVkZW50LnBhcmVudC5wYXJlbnRJZH0vaW52b2ljZXMvI3skc2NvcGUuY3VycmVudFRpbWVTaGVldEtleX1cIikucHVzaCgpLnNldCB7ZGF0ZTogdmFsdWUuZGF0ZSwgc3R1ZGVudE5hbWU6IHZhbHVlLnN0dWRlbnQubmFtZSwgbGVuZ3RoOiB2YWx1ZS5sZW5ndGgsIG5vdGVzOiB2YWx1ZS5ub3RlcywgbWVudG9ySWQ6ICRyb290U2NvcGUuY3VycmVudFVpZCwgbWVudG9yTmFtZTogXCIjeyRyb290U2NvcGUudXNlckJhc2ljLmZpcnN0TmFtZX0gI3skcm9vdFNjb3BlLnVzZXJCYXNpYy5sYXN0TmFtZX1cIn1cblxuICAgICAgICAgICRyb290U2NvcGUuY3VycmVudFVzZXJSZWYuY2hpbGQoXCJ0aW1lc2hlZXRzLyN7JHNjb3BlLmN1cnJlbnRUaW1lU2hlZXRLZXl9L3RvdGFsVGltZVwiKS5zZXQgdG90YWxUaW1lXG4gICAgICAgICAgJHJvb3RTY29wZS5jdXJyZW50VXNlclJlZi5jaGlsZChcInRpbWVzaGVldHMvI3skc2NvcGUuY3VycmVudFRpbWVTaGVldEtleX1cIikuc2V0UHJpb3JpdHkgJ3N1Ym1pdHRlZCdcblxuXG4gICAgICAkc2NvcGUubWFuYWdlTWVudG9yID0gKHVzZXJpZCwgbWVudG9yKSAtPlxuICAgICAgICAkc2NvcGUuc2hvd01hbmFnZU1lbnRvciA9IHRydWVcbiAgICAgICAgJHNjb3BlLnNob3dNYW5hZ2VNZW50b3JPYmogPSBtZW50b3JcblxuXG4gICAgICAkc2NvcGUuY2FsY3VsYXRlVG90YWxIb3Vyc0ZvckFQYXJlbnQgPSAobGVzc29ucykgLT5cbiAgICAgICAgdG90YWxIb3VycyA9IDBcbiAgICAgICAgZm9yIGssdiBvZiBsZXNzb25zXG4gICAgICAgICAgdG90YWxIb3VycyA9IHBhcnNlRmxvYXQodi5sZW5ndGgpICsgdG90YWxIb3Vyc1xuICAgICAgICB0b3RhbEhvdXJzXG5cbiAgICAgICRzY29wZS5tYW5hZ2VQYXJlbnQgPSAodXNlcmlkLCBwYXJlbnQpIC0+XG4gICAgICAgICRzY29wZS5zaG93TWFuYWdlUGFyZW50ID0gdHJ1ZVxuICAgICAgICAkc2NvcGUuc2hvd01hbmFnZVBhcmVudE9iaiA9IHBhcmVudFxuXG5cbiAgICAgICRzY29wZS5jaGVja0N1cnJlbnRQYXlQZXJpb2QgPSAoKSAtPlxuICAgICAgICBtb21lbnQoKS5pc0JldHdlZW4oJHNjb3BlLnN0YXJ0RGF0ZSwgJHNjb3BlLmVuZERhdGUpXG5cblxuXG5cbiAgRGFzaEJvYXJkQ29udHJvbGxlci4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHJvb3RTY29wZVwiLCBcIiRzY2VcIiwgXCJGaXJlYmFzZVNlcnZpY2VcIiwgXCIkd2luZG93XCIsIFwiJGZpcmViYXNlT2JqZWN0XCIsIFwiJGZpcmViYXNlQXJyYXlcIl1cblxuICBUaW1lU2hlZXRBcHAuY29udHJvbGxlciAnRGFzaEJvYXJkQ29udHJvbGxlcicsIERhc2hCb2FyZENvbnRyb2xsZXJcblxuICBEYXNoQm9hcmRDb250cm9sbGVyIl19
